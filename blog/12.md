# 从输入url到页面展示

[!img](https://cloud.githubusercontent.com/assets/7597581/18175628/8b51635e-70a4-11e6-8450-4bdc6d102177.png)

## 1 输入地址
比如输入 www.google.com
输入地址的时候，浏览器会从历史纪录中查找，对你输入的内容进行智能匹配，自动为你补全url

## 2 浏览器查找域名的 IP 地址
1 请求发起以后，浏览器首先要做的是 解析 这个域名，浏览器先会查看本地的 hosts 文件，看有没有和这个域名对应的规则，如果有就直接使用 hosts 文件里的 ip 地址

2 如果本地 hosts 文件没有找到对应的 ip 地址，浏览器会发出一个 dns 请求到 本地dns服务器。本地dns服务器 一般都是你的网络接入服务器商，比如中国电信、中国移动。

3 dns请求 到达 本地dns服务器 以后，本地dns服务器 会查询它的缓存记录，如果有则直接返回，如果没有就向 dns根服务器 查询。

4 dns根服务器 没有记录具体的域名和ip地址对应关系，而会告诉 本地dns服务器，可以到 **.com顶级域名服务器** 上查找，然后给出 **.com顶级域名服务器** 的地址。

5 本地dns服务器 向 **.com顶级域名服务器** 发出请求，**.com顶级域名服务器** 不会返回域名和ip地址对应关系，而是告诉给出 域名的解析服务器 的地址。

6 最后，本地dns服务器 向 域名的解析服务器 发出请求，能收到域名和ip地址的对应关系，本地dns服务器 不仅要把ip地址返回给用户，还要把对应关系保存在缓存里。

网址的解析是一个从右向左的过程：com -> google.com -> www.gooogle.com
根域名服务器？其实真正的网址是 www.google.com.
网址真正解析过程是：. -> .com. -> google.com. -> www.google.com.

dns负载均衡
dns服务器为同一个主机名配置多个ip地址，在应答dns查询时，dns服务器会根据一定的规则返回不同的解析结果，比如根据 每台机器的负载量，机器距离用户地理位置的距离。
比如 cdn 就是利用 dns重定向技术。

## 3 浏览器向web服务器发送一个HTTP请求
浏览器与服务器要建立TCP连接。

tcp三次握手：
握手过程使用了 TCP标志，SYN 和 ACK。
一：发送端 发送一个带 SYN标志 的数据包给 接收端
二：接收端收到以后，回传一个带有 SYN/ACK标志 的数据包，表明确认
三：发送端再回传一个带有 ACK标志 的数据包，表明 握手 结束

tcp建立以后，发起一个http请求，如GET、POST方法。
客户端发起http请求，请求信息包含三部分：
请求方法 uri 协议版本
请求首部字段
请求实体

## 4 服务器处理请求
后端对 http 协议进行解析，并按照报文格式进一步封装成 http request 对象

这里会涉及反向代理服务器。将同一个应用部署再多台服务器上，将大量用户的请求分配给多台机器处理。此时，客户端不会直接访问到网站应用服务器，而是先请求到 Nginx，Nginx 再请求应用服务器，然后将结果返回给客户端，这里 Nginx 的作用是反向代理服务器。

## 5 服务器返回一个http响应
http响应由3个部分构成：
状态行
响应头
响应正文

状态行：
由 协议版本、状态码、状态描述 组成

状态码：
1xx：信息性状态码，服务器已经收到客户端请求，客户端可以继续发送请求。
2xx：成功状态码，服务器已经成功接收请求并进行处理。
3xx：重定向状态码，
  301 永久性重定向
  302 临时性重定向
4xx：客户端错误状态码，客户端请求有非法内容
  400 请求语法错误
  401 unauthorized 未经授权
  403 不允许访问该资源
  404 资源不存在
5xx：服务端错误，服务器未能正确处理请求

Cookie：
Cookie 会根据从服务器发送的响应报文内的一个叫Set-Cookie的首部字段信息，通知客户端保存Cookie，当客户端下次再往该服务器发送请求时，客户端会自动在请求报文中加入cookie值后发送出去。

## 6 浏览器显式html
浏览器再解析html文件时，会 “自上而下” 加载，并在加载过程中进行解析渲染。再解析过程中如果遇到请求外部资源，如图片、外链css，请求过程时异步的，不会影响html文档加载。

当文档加载过程中遇到 js 文件，html文档会挂起渲染线程，不仅要等js文件加载完，还要等解析执行完，才可以恢复html文档的渲染线程。因为js可能会修改dom，因此后续的资源的下载可能时没有必要的。

js解析由浏览器的js解析引擎完成。js是单线程，但是有些任务比较耗时，比如io，所以有一种机制可以先执行排在后面的任务：同步任务 和 异步任务。
js的执行机制可以看做是一个 **主线** 程加上一个 **任务队列**。同步任务是放在主线程上执行的任务，异步任务是放在任务队列中的任务。
所有的同步任务在主线程上执行，形成一个执行栈；异步任务有了运行结果就会在任务队列中放置一个事件；脚本运行时先依次运行执行栈，然后从任务队列里提取事件，运行任务队列中的任务，这个过程是不断重复的，叫做 **事件循环**。

## 7 浏览器发送请求获取嵌入在html中的资源







